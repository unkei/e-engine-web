(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class p{constructor(){this.listeners=[]}subscribe(s){this.listeners.push(s)}notify(s){this.listeners.forEach(e=>e(s))}connect(){throw new Error("Method 'connect()' must be implemented.")}}class f extends p{constructor(){super(),this.throttle=0,this.speed=0,this.container=null}connect(){console.log("MockProvider: Connecting..."),this.createDebugUI(),this.startLoop()}createDebugUI(){this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.bottom="20px",this.container.style.right="20px",this.container.style.backgroundColor="rgba(0, 0, 0, 0.8)",this.container.style.padding="15px",this.container.style.borderRadius="8px",this.container.style.color="white",this.container.style.zIndex="1000",this.container.style.fontFamily="monospace",this.container.innerHTML=`
      <h3>Mock Data Controls</h3>
      <div style="margin-bottom: 10px;">
        <label>Throttle: <span id="debug-throttle-val">0</span>%</label>
        <input type="range" id="debug-throttle" min="0" max="100" value="0" style="width: 100%;">
      </div>
      <div style="margin-bottom: 10px;">
        <label>Speed: <span id="debug-speed-val">0</span> km/h</label>
        <input type="range" id="debug-speed" min="0" max="150" value="0" style="width: 100%;">
      </div>
    `,document.body.appendChild(this.container);const s=document.getElementById("debug-throttle"),e=document.getElementById("debug-speed");s.addEventListener("input",t=>{this.throttle=parseFloat(t.target.value),document.getElementById("debug-throttle-val").innerText=this.throttle,this.emitUpdate()}),e.addEventListener("input",t=>{this.speed=parseFloat(t.target.value),document.getElementById("debug-speed-val").innerText=this.speed,this.emitUpdate()})}startLoop(){}emitUpdate(){this.notify({throttle:this.throttle,speed:this.speed,voltage:72,current:this.throttle*2})}}class m{constructor(){this.idleRPM=1e3,this.maxRPM=12e3,this.redlineRPM=11e3,this.gearRatios=[150,100,75,60,50,45],this.shiftUpRPM=9e3,this.shiftDownRPM=4e3,this.currentGear=0,this.currentRPM=this.idleRPM,this.lastShiftTime=0,this.shiftDelay=500}update(s,e,t){const n=Date.now();let i=this.idleRPM;if(t<1)i=this.idleRPM+e/100*(this.maxRPM-this.idleRPM),this.currentGear=0;else{const r=this.gearRatios[this.currentGear];i=t*r,i<this.idleRPM&&(i=this.idleRPM),n-this.lastShiftTime>this.shiftDelay&&(i>this.shiftUpRPM&&this.currentGear<this.gearRatios.length-1?(this.currentGear++,this.lastShiftTime=n,i=t*this.gearRatios[this.currentGear]):i<this.shiftDownRPM&&this.currentGear>0&&(this.currentGear--,this.lastShiftTime=n,i=t*this.gearRatios[this.currentGear]))}return this.currentRPM=i,{rpm:this.currentRPM,gear:this.currentGear+1,load:e/100}}}class g{constructor(){this.ctx=null,this.masterGain=null,this.osc1=null,this.osc2=null,this.noise=null,this.filter=null,this.isRunning=!1}async init(){const s=window.AudioContext||window.webkitAudioContext;this.ctx=new s,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.value=.5,this.filter=this.ctx.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=400,this.filter.Q.value=1,this.filter.connect(this.masterGain),this.osc1=this.ctx.createOscillator(),this.osc1.type="sawtooth",this.osc1.frequency.value=50,this.osc1.connect(this.filter),this.osc2=this.ctx.createOscillator(),this.osc2.type="square",this.osc2.frequency.value=100;const e=this.ctx.createGain();e.gain.value=.3,this.osc2.connect(e),e.connect(this.filter),this.osc1.start(),this.osc2.start(),this.isRunning=!0,console.log("SoundEngine: Started")}update(s,e){if(!this.isRunning)return;const t=Math.max(s,100)/60;this.osc1&&this.osc1.frequency.setTargetAtTime(t,this.ctx.currentTime,.05),this.osc2&&this.osc2.frequency.setTargetAtTime(t*.5,this.ctx.currentTime,.05);const n=200,i=s*.5,r=e*1e3,a=n+i+r;this.filter&&this.filter.frequency.setTargetAtTime(a,this.ctx.currentTime,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}}class y{constructor(s){this.container=document.getElementById(s),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.resize(),window.addEventListener("resize",()=>this.resize()),this.rpm=0,this.speed=0,this.gear=1,this.maxRPM=12e3}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}update(s,e,t){this.rpm=s,this.speed=e,this.gear=t,this.draw()}draw(){const s=this.canvas.width,e=this.canvas.height,t=this.ctx;t.fillStyle="#1a1a1a",t.fillRect(0,0,s,e);const n=s/2,i=e/2,r=Math.min(s,e)*.35;t.beginPath(),t.arc(n,i,r,Math.PI*.8,Math.PI*2.2),t.strokeStyle="#333",t.lineWidth=20,t.stroke();const a=Math.PI*.8,d=Math.PI*2.2-a,u=a+this.rpm/this.maxRPM*d;t.beginPath(),t.arc(n,i,r,a,u),t.strokeStyle=this.rpm>1e4?"#ff3333":"#00ccff",t.lineWidth=20,t.stroke(),t.textAlign="center",t.fillStyle="white",t.font="bold 60px sans-serif",t.fillText(Math.floor(this.speed),n,i+20),t.font="20px sans-serif",t.fillStyle="#888",t.fillText("km/h",n,i+50),t.font="bold 40px sans-serif",t.fillStyle="#ffcc00",t.fillText(this.gear,n,i-80),t.font="16px sans-serif",t.fillStyle="#888",t.fillText(`${Math.floor(this.rpm)} RPM`,n,i+120)}showStartButton(s){const e=document.createElement("button");e.innerText="START ENGINE",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.padding="20px 40px",e.style.fontSize="24px",e.style.background="#00ccff",e.style.border="none",e.style.borderRadius="8px",e.style.cursor="pointer",e.style.zIndex="2000",e.onclick=()=>{e.remove(),s()},document.body.appendChild(e)}}console.log("EV Sound Simulator Starting...");const c=new f,x=new m,h=new g,l=new y("app");l.showStartButton(async()=>{await h.init(),c.connect()});c.subscribe(o=>{const s=x.update(.016,o.throttle,o.speed);h.update(s.rpm,s.load),l.update(s.rpm,o.speed,s.gear)});
